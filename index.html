<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>95 BATCH स्नेहसंमेलन 2025</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
    }
    header {
      background-color: #0d3b66;
      color: white;
      text-align: center;
      padding: 20px 10px;
    }
    header img {
      max-width: 100px;
      margin-bottom: 10px;
    }
    .balance {
      font-weight: bold;
      font-size: 1.2rem;
      margin: 10px 0;
    }
    .table-responsive {
      margin-top: 15px;
    }
    .btn-csv {
      background-color: #0d6efd;
      color: white;
    }
    .badge-success {
      background-color: #28a745;
    }
    .badge-danger {
      background-color: #dc3545;
    }
    #adminSection {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <img src="IMG_0143.jpeg" alt="logo">
    <h3>95 BATCH स्नेहसंमेलन 2025</h3>
  </header>

  <!-- Login Section -->
  <div class="container my-3">
    <div class="card shadow p-3">
      <h5 class="text-center">Admin Login</h5>
      <form id="loginForm" class="row g-2">
        <div class="col-md-5 col-12">
          <input type="email" id="loginEmail" placeholder="ई-मेल" class="form-control" required>
        </div>
        <div class="col-md-5 col-12">
          <input type="password" id="loginPassword" placeholder="पासवर्ड" class="form-control" required>
        </div>
        <div class="col-md-2 col-12 text-center">
          <button type="submit" class="btn btn-primary w-100">Login</button>
        </div>
      </form>
      <div id="loginMsg" class="text-danger text-center mt-2"></div>
    </div>
  </div>

  <!-- Admin Section -->
  <div class="container my-4" id="adminSection">
    <div class="card shadow p-3">
      <form id="entryForm" class="row g-2">
        <div class="col-md-3 col-12">
          <input type="date" id="date" class="form-control" required>
        </div>
        <div class="col-md-3 col-12">
          <input type="text" id="name" placeholder="नाव" class="form-control" required>
        </div>
        <div class="col-md-3 col-12">
          <select id="type" class="form-select" required>
            <option value="जमा">जमा</option>
            <option value="खर्च">खर्च</option>
          </select>
        </div>
        <div class="col-md-3 col-12">
          <input type="number" id="amount" placeholder="रक्कम" class="form-control" required>
        </div>
        <div class="col-12 text-center mt-2">
          <button type="submit" class="btn btn-success">जतन करा</button>
        </div>
      </form>
      <div class="text-center balance text-success" id="balance">शिल्लक रक्कम: ₹0</div>
      <button id="downloadCsv" class="btn btn-csv mt-2">CSV डाउनलोड करा</button>
    </div>
  </div>

  <!-- Table -->
  <div class="container">
    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle">
        <thead class="table-dark">
          <tr>
            <th>तारीख</th>
            <th>नाव</th>
            <th>रक्कम</th>
            <th>प्रकार</th>
          </tr>
        </thead>
        <tbody id="dataTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // ✅ Firebase Config (UPPER PART)
    const firebaseConfig = {
      apiKey: "AIzaSyBhrHcBSK1G1EmFW12_eBfA14mHhZd1MdI",
      authDomain: "batch1995-11ec2.firebaseapp.com",
      databaseURL: "https://batch1995-11ec2-default-rtdb.firebaseio.com",
      projectId: "batch1995-11ec2",
      storageBucket: "batch1995-11ec2.firebasestorage.app",
      messagingSenderId: "386074895473",
      appId: "1:386074895473:web:6e14f976479aeb0c68a7d0",
      measurementId: "G-4H1H2TPXYY"
    };

    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const loginForm = document.getElementById("loginForm");
    const loginMsg = document.getElementById("loginMsg");
    const adminSection = document.getElementById("adminSection");

    const form = document.getElementById("entryForm");
    const dataTable = document.getElementById("dataTable");
    const balanceEl = document.getElementById("balance");
    const downloadBtn = document.getElementById("downloadCsv");

    // ✅ Admin Login
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;

      signInWithEmailAndPassword(auth, email, password)
        .then(() => {
          loginMsg.innerText = "";
          adminSection.style.display = "block"; // show admin section
          loginForm.style.display = "none"; // hide login
        })
        .catch((error) => {
          loginMsg.innerText = "Login Failed! चुकीचे ई-मेल किंवा पासवर्ड.";
          console.error(error);
        });
    });

    // ✅ Save entry (Only Admin can add)
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = document.getElementById("date").value;
      const name = document.getElementById("name").value;
      const type = document.getElementById("type").value;
      const amount = parseFloat(document.getElementById("amount").value);

      push(ref(db, "entries"), { date, name, type, amount });
      form.reset();
    });

    // ✅ Fetch entries (Everyone can see)
    onValue(ref(db, "entries"), (snapshot) => {
      dataTable.innerHTML = "";
      let balance = 0;
      snapshot.forEach(child => {
        const entry = child.val();
        if (entry.type === "जमा") balance += entry.amount;
        else balance -= entry.amount;

        dataTable.innerHTML += `
          <tr>
            <td>${entry.date}</td>
            <td>${entry.name}</td>
            <td>${entry.amount}</td>
            <td><span class="badge ${entry.type === "जमा" ? "badge-success" : "badge-danger"}">${entry.type}</span></td>
          </tr>
        `;
      });
      balanceEl.innerText = `शिल्लक रक्कम: ₹${balance}`;
    });

    // ✅ CSV Download
    downloadBtn.addEventListener("click", () => {
      let csv = "तारीख,नाव,रक्कम,प्रकार\n";
      document.querySelectorAll("#dataTable tr").forEach(row => {
        let cols = row.querySelectorAll("td");
        let rowData = [];
        cols.forEach(col => rowData.push(col.innerText));
        csv += rowData.join(",") + "\n";
      });

      const blob = new Blob([csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "batch1995_data.csv";
      link.click();
    });
  </script>
</body>
</html>
