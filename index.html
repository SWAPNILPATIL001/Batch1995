<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <title>‡•ß‡•Ø‡•Ø‡•´ Batchmates ‡§∏‡•ç‡§®‡•á‡§π‡§∏‡§Ç‡§Æ‡•á‡§≤‡§® ‡•®‡•¶‡•®‡•´</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Noto Sans Devanagari', sans-serif; background:#f9f9f9; text-align:center; margin:0; padding:0; }
    header { background:#4CAF50; color:white; padding:10px; }
    header img { max-height:80px; vertical-align:middle; }
    header h1 { display:inline-block; margin-left:10px; font-size:22px; vertical-align:middle; }
    form { margin:20px auto; padding:15px; background:white; max-width:500px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
    form input, form select, form button { margin:5px; padding:10px; width:90%; border:1px solid #ccc; border-radius:4px; }
    form button { background:#4CAF50; color:white; border:none; cursor:pointer; }
    table { margin:20px auto; border-collapse:collapse; width:90%; background:white; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
    th, td { padding:10px; border:1px solid #ddd; }
    th { background:#f2f2f2; }
    .balance-box { margin:20px auto; background:#fff; padding:10px; max-width:300px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2); font-size:18px; }
    .download-btn { margin:20px auto; background:#2196F3; color:white; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <img src="IMG_0143.jpeg" alt="Batchmates Logo">
    <h1>‡•ß‡•Ø‡•Ø‡•´ Batchmates ‡§∏‡•ç‡§®‡•á‡§π‡§∏‡§Ç‡§Æ‡•á‡§≤‡§® ‡•®‡•¶‡•®‡•´</h1>
  </header>

  <div class="balance-box">
    ‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï ‡§∞‡§ï‡•ç‡§ï‡§Æ: <span id="balance">0</span> ‚Çπ
  </div>

  <form id="entryForm">
    <input type="date" id="date" required>
    <input type="text" id="name" placeholder="‡§®‡§æ‡§µ" required>
    <select id="type" required>
      <option value="credit">‡§ú‡§Æ‡§æ</option>
      <option value="debit">‡§ñ‡§∞‡•ç‡§ö</option>
    </select>
    <input type="number" id="amount" placeholder="‡§∞‡§ï‡•ç‡§ï‡§Æ" required>
    <button type="submit">‡§ú‡§§‡§® ‡§ï‡§∞‡§æ</button>
  </form>

  <button class="download-btn" id="downloadBtn">CSV ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ</button>

  <table>
    <thead>
      <tr>
        <th>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï</th>
        <th>‡§®‡§æ‡§µ</th>
        <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
        <th>‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js"></script>

  <script>
    // üî• Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBhrHcBSK1G1EmFW12_eBfA14mHhZd1MdI",
      authDomain: "batch1995-11ec2.firebaseapp.com",
      databaseURL: "https://batch1995-11ec2-default-rtdb.firebaseio.com",
      projectId: "batch1995-11ec2",
      storageBucket: "batch1995-11ec2.firebasestorage.app",
      messagingSenderId: "386074895473",
      appId: "1:386074895473:web:6e14f976479aeb0c68a7d0",
      measurementId: "G-4H1H2TPXYY"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const form = document.getElementById("entryForm");
    const tableBody = document.getElementById("tableBody");
    const balanceEl = document.getElementById("balance");
    let allData = [];

    // ‚úÖ ‡§°‡•á‡§ü‡§æ ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = document.getElementById("date").value;
      const name = document.getElementById("name").value;
      const type = document.getElementById("type").value;
      const amount = parseFloat(document.getElementById("amount").value);

      if (!date || !name || !amount) return;

      const newRef = db.ref("transactions").push();
      newRef.set({
        date, name, type, amount
      });

      form.reset();
    });

    // ‚úÖ ‡§°‡•á‡§ü‡§æ realtime ‡§µ‡§æ‡§ö‡§æ
    db.ref("transactions").on("value", (snapshot) => {
      tableBody.innerHTML = "";
      allData = [];
      let balance = 0;

      snapshot.forEach((childSnapshot) => {
        const d = childSnapshot.val();
        allData.push(d);
        balance += d.type === "credit" ? d.amount : -d.amount;

        const badge = `<span style="padding:4px 8px;color:#fff;background:${d.type==="credit"?"green":"red"};border-radius:4px;">${d.type==="credit"?"‡§ú‡§Æ‡§æ":"‡§ñ‡§∞‡•ç‡§ö"}</span>`;
        tableBody.innerHTML += `
          <tr>
            <td>${d.date}</td>
            <td>${d.name}</td>
            <td>${badge}</td>
            <td>${d.amount}</td>
          </tr>`;
      });

      balanceEl.textContent = balance;
    });

    // ‚úÖ CSV ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°
    document.getElementById("downloadBtn").addEventListener("click", () => {
      if (allData.length === 0) {
        alert("‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä");
        return;
      }

      let csvContent = "‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï,‡§®‡§æ‡§µ,‡§™‡•ç‡§∞‡§ï‡§æ‡§∞,‡§∞‡§ï‡•ç‡§ï‡§Æ(‚Çπ)\n";
      allData.forEach((row) => {
        csvContent += `${row.date},${row.name},${row.type==="credit"?"‡§ú‡§Æ‡§æ":"‡§ñ‡§∞‡•ç‡§ö"},${row.amount}\n`;
      });

      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "transactions.csv";
      link.click();
    });
  </script>
</body>
</html>          <td>${d.name}</td>
          <td>${badge}</td>
          <td>${d.amount}</td>
        </tr>`;
      });

      balanceEl.textContent = balance;
    }, (err) => {
      console.error("Snapshot error:", err);
    });

    // CSV Download
    document.getElementById("downloadBtn").addEventListener("click", () => {
      if (allData.length === 0) {
        alert("‡§°‡•á‡§ü‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä");
        return;
      }

      let csvContent = "‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï,‡§®‡§æ‡§µ,‡§™‡•ç‡§∞‡§ï‡§æ‡§∞,‡§∞‡§ï‡•ç‡§ï‡§Æ(‚Çπ)\n";
      allData.forEach((row) => {
        csvContent += `${row.date},${row.name},${row.type==="credit"?"‡§ú‡§Æ‡§æ":"‡§ñ‡§∞‡•ç‡§ö"},${row.amount}\n`;
      });

      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "transactions.csv";
      link.click();
    });
  </script>
</body>
</html>
